---
title: "Introdução ao R<br>Aula 3"
output: 
  xaringan::moon_reader:
    lib_dir: libs
    nature:
      ratio: 16:9
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

# Percurso do curso

1. [Noções](#13) de **R**

2. Como [visualizar](#75) os dados?

3. Como [importar](#30) os dados?

4. Como [transformar](#35) os dados?

---

# Percurso de hoje

1. Motivação

2. Objetos

3. Vetores

4. Comparações lógicas e numéricas

5. Funções

6. Controle de fluxo

---

class: inverse, center, middle

# Como <a>transformar</a> os dados

---
background-image: url(www/data-science.png)
background-size: 100%
class: center

# <a>Ciclo</a> de análise de dados

---
background-image: url(www/pipe.jpg)
background-size: 85%
class: center

---

```{r, include = FALSE}
library(tidyverse)
simbioticos <- tibble::tibble(
  `Subject ID` = 1:30,
  Age = round(rnorm(30, 40, 5)), 
  vitDin = rnorm(30, 2, 0.3), 
  GRUPO = sample(c("Cão", "Gato"), 30, TRUE),
  `Sex M/F` = sample(c("H", "M"), 30, TRUE),
  IMC_inicial= round(rnorm(30, 40, 5)), 
  IMC_av1 = rnorm(30, 2, 0.3), 
  IMC_av2 = round(rnorm(30, 40, 5))
)
```


# %>% (pipe)

O <a>pipe</a> está baseado na pintura do artista belga Magritte.

```{r}
valores <- rnorm(10, 10, 2)
mean(abs(diff(valores)))
```

<br>

Vejamos a mesma operação com o <a>pipe</a>

```{r}
# Ceci n'est pas une "operador"
valores %>% 
  diff() %>% 
  abs() %>% 
  mean()
```

---

# <a>dplyr</a> e <a>tidyr</a>

Uma filosofia comum:

1. O primeiro argumento de cada função é um data.frame

2. Toda função retorna um data.frame

---

# select

Use <a>select()</a> para nomear as variáveis (colunas) que quer manter ou 
remover do data.frame.

```{r, eval = FALSE}
select(data.frame, coluna1, coluna2)

# ou com o pipe
data.frame %>% 
  select(coluna1, coluna2)

data.frame %>% 
  select(-coluna1)
```

---

# select

Formas mais comuns de usar o <a>select</a>

```{r}
simbioticos %>% 
  select(`Subject ID`, GRUPO , Age, vitDin, `Sex M/F`) %>% head(1)

simbioticos %>% 
  select(-IMC_inicial, -IMC_av1, -IMC_av2) %>% head(1)
```

---

# select

Formas mais comuns de usar o <a>select</a>

```{r}
simbioticos %>% 
  select(`Subject ID`:`Sex M/F`) %>% head(1)

simbioticos %>% 
  select(- (`Subject ID`:`Sex M/F`)) %>% head(1)
```

---

# select

Formas menos comuns de usar o <a>select</a>

```{r}
simbioticos %>% 
  select(1, 2, 3) %>% head(1)

simbioticos %>% 
  select(contains("in")) %>% head(1)
```

---

# select

Formas menos comuns de usar o <a>select</a>

```{r}
simbioticos %>% 
  select(starts_with("IMC") ) %>% head(1)

simbioticos %>% 
  select(ends_with("O")) %>% head(1)
```

---

# filter

Use <a>filter()</a> para definir as condições para que as observações 
(linhas) sejam mantidas no data.frame.

A condição deve ser uma expressão que deve ser avaliada num vetor lógico.

```{r, eval = FALSE}
filter(data.frame,  condicao)

# ou com pipe
data.frame %>% 
  filter(condicao)
```

Mais de uma condições podem ser passadas. Neste caso apenas as observações 
que satisfaçam todas as condições serão mantidas.

---

# filter

```{r}
simbioticos %>% 
  filter(`Sex M/F` == "H")

simbioticos %>% 
  filter(Age >= 50)
```

---

# filter

```{r}
simbioticos %>% 
  filter(`Sex M/F` != "H")

simbioticos %>% 
  filter(GRUPO %in% c("Gato", "Cão"))
```

---

# arrange

Use <a>arrange()</a> para reordenar as observações (linhas) de acordo com os 
valores de algumas colunas. Por padrão as linhas são apresentadas em ordem 
crescente, mas esse comportamento pode ser alterado usando a função <a>desc</a>.

```{r, eval = FALSE}
arrange(data.frame, coluna1)

data.frame %>% 
  arrange(coluna1)

data.frame %>% 
  arrange(desc(coluna1))
```


---

# arrange

Use <a>arrange()</a> para reordenar as observações (linhas)

```{r}
simbioticos %>% 
  arrange(Age)

simbioticos %>% 
  arrange(Age, desc(vitDin))
```

---

# mutate

Use <a>mutate()</a> para criar novas variáveis baseadas nas variáveis existentes

```{r}
simbioticos %>% 
  mutate(Age_final = Age + 5)
```

---

# group_by

Use <a>group_by()</a> para agrupar os dados e realizar operações para cada grupo

É usado em conjunto com outros verbos. Ele qualifica os demais verbos 
e as ações passam a ocorrer separadamente para cada grupo

```{r}
simbioticos %>% 
  group_by(GRUPO) %>% 
  filter(vitDin == max(vitDin, na.rm = TRUE))
```

---

# summarise

Use <a>summarise()</a> para criar resumos dos dados. As funções passadas devem 
retornar um único valor

```{r}
simbioticos %>% 
  summarise(mediaDin = mean(vitDin, na.rm = TRUE))

simbioticos %>% 
  group_by(GRUPO) %>% 
  summarise(mediaDin = mean(vitDin, na.rm = TRUE))
```

---

# Exercícios

<br>

> 1. <a>Quantos</a> pacientes possuiam vitamina D inicial 
<a>maior do que 50</a>?

> 2. <a>Quantos</a> pacientes tinham idade <a>inferior a 70</a> anos?

> 3. Qual o <a>ID</a> do paciente com <a>maior altura</a>?

> 4. Qual o <a>sexo</a> no pacitente <a>mais baixo</a>?

> 5. Que <a>grupo</a> de pacientes possui a <a>maior idade média</a>?

> 6. Qual o <a>paciente mais velho</a> que teve <a>aumento de vitamina D</a>?

> 7. Qual foi a <a>variação média de altura</a> em cada grupo?

---
class: inverse, center, middle

# Como <a>organizar</a> os dados

---
background-image: url(www/data-science.png)
background-size: 100%
class: center

# <a>Ciclo</a> de análise de dados

---

# <a>Principios</a>

<br><br>

1. Cada <a>variável</a> tem sua própria <a>coluna</a>

2. Cada <a>observação</a> tem sua própria <a>linha</a>

3. Cada <a>unidade observacional</a> tem sua própria <a>tabela</a>

---
background-image: url(www/original-dfs-tidy.png)
background-size: 60%
background-position: 50% 90%

# <a>Formas</a> de uma tabela

---
background-image: url(www/tidyr-spread-gather.gif)
background-size: 45%
background-position: 50% 100%

# <a>Transformações</a> de uma tabela

---

# <a>Juntar</a>

```{r}
simb2 <- simbioticos %>% 
  select(`Subject ID`, IMC_inicial, IMC_av1, IMC_av2)
simb2
```

---
# <a>Juntar</a>

```{r}
simb_tidy <- gather(simb2, key = periodo, 
                    value = IMC, -`Subject ID`)
simb_tidy
```

---

# <a>Juntar</a>

```{r, eval = FALSE}
simb_tidy <- gather(simb2, key = periodo, 
                    value = IMC, -`Subject ID`)
simb_tidy
```

### Como ler

<a>"Quero juntar os dados de **simb2** em **periodo** e **IMC**. Vou juntar
todas as colunas, exceto 'Subject ID' "</a>

```{r, eval = FALSE}
# Não tenha vergonha de pedir ajuda ao R
?gather 
```

---

# <a>Espalhar</a>

```{r}
spread(simb_tidy, periodo, IMC) %>% head()
```

### Como ler

<a>"Quero espalhar o **IMC** contido **simb_tidy** de acordo com os **períodos**."</a>

```{r, eval = FALSE}
# Não tenha vergonha de pedir ajuda ao R
?spread 
```
